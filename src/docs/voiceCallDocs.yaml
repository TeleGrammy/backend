asyncapi: "2.6.0"
info:
  title: TeleGrammy API
  version: "1.0.0"
  description: Documentation for Voice Calls
defaultContentType: application/json

servers:
  local:
    url: "ws://localhost:8080"
    protocol: ws
    description: Local WebSocket server for development

channels:
  /callInit:
    description: Channel for initiating a one-on-one or group call.
    publish:
      summary: Initiate a one-on-one or group call.
      operationId: initiateCall
      message:
        $ref: "#/components/messages/InitCall"
    subscribe:
      summary: Receive confirmation of call initiation.
      operationId: receiveCallInitiationResponse
      message:
        $ref: "#/components/messages/CallInitiatedResponse"

  /callJoin:
    description: Channel for joining an active group call.
    publish:
      summary: Join an active group call.
      operationId: joinCall
      message:
        $ref: "#/components/messages/JoinCall"
    subscribe:
      summary: Receive confirmation of joining the call.
      operationId: receiveJoinCallResponse
      message:
        $ref: "#/components/messages/JoinCallResponse"

  /callIceCandidate:
    description: Channel for sending and receiving ICE candidates for network traversal.
    publish:
      summary: Send ICE candidates for network traversal.
      operationId: sendIceCandidate
      message:
        $ref: "#/components/messages/IceCandidate"
    subscribe:
      summary: Receive ICE candidates from the other party.
      operationId: receiveIceCandidate
      message:
        $ref: "#/components/messages/IceCandidateResponse"

  /callMute:
    description: Channel for muting microphone within a call.
    publish:
      summary: Mute microphone.
      operationId: muteMicrophone
      message:
        $ref: "#/components/messages/MuteUnmute"
    subscribe:
      summary: Receive confirmation of microphone mute action.
      operationId: receiveMuteResponse
      message:
        $ref: "#/components/messages/MuteUnmuteResponse"

  /callUnmute:
    description: Channel for unmuting microphone within a call.
    publish:
      summary: Unmute microphone.
      operationId: unmuteMicrophone
      message:
        $ref: "#/components/messages/MuteUnmute"
    subscribe:
      summary: Receive confirmation of microphone unmute action.
      operationId: receiveUnmuteResponse
      message:
        $ref: "#/components/messages/MuteUnmuteResponse"

  /callEnd:
    description: Channel for ending an active call.
    publish:
      summary: End the active call.
      operationId: endCall
      message:
        $ref: "#/components/messages/EndCall"
    subscribe:
      summary: Receive confirmation of call end.
      operationId: receiveEndCallResponse
      message:
        $ref: "#/components/messages/EndCallResponse"

components:
  messages:
    InitCall:
      contentType: application/json
      payload:
        type: object
        properties:
          callerId:
            type: string
            description: The ID of the caller.
          calleeId:
            type: array
            items:
              type: string
            description: The IDs of the callee(s).
        required:
          - callerId
          - calleeId

    CallInitiatedResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          sessionId:
            type: string
            description: ID of the newly initiated call session.
          webrtcOffer:
            type: string
            description: WebRTC offer for the connection.
          encryptionToken:
            type: string
            description: Token for end-to-end encryption.

    JoinCall:
      contentType: application/json
      payload:
        type: object
        properties:
          sessionId:
            type: string
            description: ID of the call session to join.
          userId:
            type: string
            description: ID of the user who want to join the call
          webrtcOffer:
            type: string
            description: WebRTC offer generated by the client.

    JoinCallResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          status:
            type: string
          webrtcAnswer:
            type: string
          message:
            type: string

    IceCandidate:
      contentType: application/json
      payload:
        type: object
        properties:
          sessionId:
            type: string
            description: ID of the ongoing call session.
          iceCandidate:
            type: string
            description: ICE candidate data from WebRTC client.

    IceCandidateResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          status:
            type: string
          message:
            type: string

    MuteUnmute:
      contentType: application/json
      payload:
        type: object
        properties:
          sessionId:
            type: string
            description: ID of the ongoing call session.
          userId:
            type: string
            description: ID of the user who want to mute or unmute the voice

    MuteUnmuteResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          status:
            type: string
          message:
            type: string

    EndCall:
      contentType: application/json
      payload:
        type: object
        properties:
          sessionId:
            type: string
            description: ID of the call session to end.
          userId:
            type: string
            description: The id of the user who want to end the call

    EndCallResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          status:
            type: string
          call:
            type: object
            properties:
              duration:
                type: string
                format: time
              startTime:
                type: string
                format: date-time
              endTime:
                type: string
                format: date-time
          message:
            type: string

    CallHistoryRequest:
      contentType: application/json
      payload:
        type: object
        properties:
          requestType:
            type: string
            description: Type of request for call history.

    CallHistoryResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          status:
            type: string
          calls:
            type: array
            items:
              type: object
              properties:
                callId:
                  type: string
                participants:
                  type: array
                  items:
                    type: string
                duration:
                  type: string
                  format: time
